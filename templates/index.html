<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain Tumor Detection</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="bg-medical">

<div class="d-flex flex-column min-vh-100">

    <!-- Main Container -->
    <div class="container flex-grow-1 d-flex align-items-center justify-content-center py-5">
        <div class="card glass-card shadow-lg p-4" style="max-width: 700px; width: 100%;">
            <div class="text-center mb-4">
                <h1 class="fw-bold text-white"><i class="fa-solid fa-brain"></i> Brain Tumor Detection</h1>
                <p class="text-light">Upload an MRI scan to detect the presence of a brain tumor.</p>
            </div>

            <!-- Upload Form -->
            <form id="tumor-form">
                <div class="mb-3">
                    <label for="imageUpload" class="form-label text-white fw-semibold"><i class="fa-solid fa-image"></i> Upload MRI Scan</label>
                    <input type="file" class="form-control" id="imageUpload" name="file" accept="image/*" required>
                </div>
                <div class="mb-3 image-preview" id="imagePreview"></div>
                <div class="d-grid">
                    <button type="submit" class="btn btn-gradient btn-lg fw-bold"><i class="fa-solid fa-microscope"></i> Detect Tumor</button>
                </div>
            </form>

            <!-- Result Box -->
            <div id="result-box" class="alert alert-info text-center mt-4 d-none">
                <h4>Detection Result</h4>
                <p id="prediction-text" class="fw-bold"></p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="mt-auto text-center py-4 bg-dark text-light">
        <p>&copy; 2025 Brain Tumor Detection System | Powered by AI & ML</p>
        <b>Author: Aziz Ashfak</b><br>
        <b>LinkedIn: <a href="https://www.linkedin.com/in/aziz-ashfak-/">click here</a></b> | 
        <b>GitHub: <a href="https://github.com/AzizAshfak/">click here</a></b><br>
        <b>Email:</b> azizashfak@gmail.com
    </footer>
</div>

<!-- Bootstrap JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>

<!-- AJAX + Image Preview Script -->
<script>
const form = document.getElementById("tumor-form");
const resultBox = document.getElementById("result-box");
const predictionText = document.getElementById("prediction-text");
const imageUpload = document.getElementById("imageUpload");
const imagePreview = document.getElementById("imagePreview");

// Image preview
imageUpload.addEventListener("change", function(event) {
    const file = event.target.files[0];
    if(file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const imgElement = document.createElement("img");
            imgElement.src = e.target.result;
            imgElement.className = "preview-img img-fluid rounded shadow-sm";
            imagePreview.innerHTML = "";
            imagePreview.appendChild(imgElement);
        };
        reader.readAsDataURL(file);
    }
});

// AJAX form submit
form.addEventListener("submit", async function(e) {
    e.preventDefault();

    const formData = new FormData(form);

    try {
        const response = await fetch("/predict", {
            method: "POST",
            body: formData
        });

        const result = await response.json();
        predictionText.textContent = result.prediction || result["Prediction "];
        resultBox.classList.remove("d-none");
        resultBox.scrollIntoView({ behavior: "smooth" });

    } catch (error) {
        predictionText.textContent = "Error: Unable to detect. Try again.";
        resultBox.classList.remove("d-none");
        resultBox.scrollIntoView({ behavior: "smooth" });
    }
});
</script>
</body>
</html>
